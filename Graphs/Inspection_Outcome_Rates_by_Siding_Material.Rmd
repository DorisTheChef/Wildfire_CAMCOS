---
title: "Inspection Outcome Rates by Siding Material"
author: "Priyanka Goel"
date: "2025-09-07"
output: html_document
---



```{r}
library(tidyverse)
library(readxl)
library(stringr)

setwd("/Users/priyankagoel")


# --- 2. Load Data ---

file_path <- 'CAMCOS and HIZ.xlsx'

field_data <- read_excel(file_path, sheet = 'Field data', skip = 1)


siding_material_col <- 'Siding material'
inspection_col <- 'Did it pass the most recent cal fire inspection?'

percentage_data <- field_data %>%
  rename(siding_material = !!sym(siding_material_col), 
         inspection_status = !!sym(inspection_col)) %>%
  # Remove rows where siding_material is NA, if any
  filter(!is.na(siding_material)) %>%
  # Add a column with the total count for each siding type
  add_count(siding_material, name = "total_per_siding") %>%
  # Count the combinations of siding and inspection status
  count(siding_material, inspection_status, total_per_siding, name = "count") %>%
  # Calculate the percentage
  mutate(percentage = count / total_per_siding * 100) %>%
  # Create the final x-axis label, e.g., "Wood (N=123)"
  mutate(siding_label = str_wrap(
    paste0(siding_material, " (N=", total_per_siding, ")"),
    width = 18
  )) %>%
  ungroup() 

# View the resulting data frame
print(percentage_data)

# --- 4. Plot Setup (using ggplot2) ---

plot <- ggplot(
    percentage_data, 
    
    aes(x = siding_label, y = percentage, fill = inspection_status)
  ) +
  geom_col(position = "dodge", width = 0.8) +
  
  # --- 5. Add labels on top of bars ---
  geom_text(
    aes(label = sprintf("%.1f%%", percentage)), 
    position = position_dodge(width = 0.9),
    vjust = -0.5,
    size = 2.8
  ) +
  
  # --- 6. Titles, Labels, and Legend ---
  
  labs(
    title = str_wrap("Inspection Outcome Rates by Siding Material", width = 60),
    x = "Siding Material (Total Count)",
    y = "Percentage of Homes (%)",
    fill = str_wrap(inspection_col, width = 25)
  ) +

  # --- 7. Theming and Final Adjustments ---
  theme_minimal(base_size = 14) + 
  theme(
    
    plot.title = element_text(face = "bold", hjust = 0.5),
    # Center the axis titles
    axis.title.x = element_text(hjust = 0.5),
    axis.title.y = element_text(hjust = 0.5),
    # Rotate x-axis labels for readability
    axis.text.x = element_text(angle = 30, hjust = 1),
    # Move legend to the right
    legend.position = "right",
    # Add some space around the plot
    plot.margin = margin(t = 20, r = 20, b = 20, l = 10, unit = "pt")
  ) +
  
  scale_fill_viridis_d() +
  
  expand_limits(y = max(percentage_data$percentage) * 1.25)

print(plot)


```

**Insight 1: Combustible vs. Non-Combustible is Not a Clear Predictor**

This is the most surprising and important finding. The simple assumption that "non-combustible siding is better" does not hold true for predicting the inspection outcome in this dataset.

The failure rate (No) for homes with masonry (a non-combustible material) is 28.6%. This is almost identical to the 30.4% failure rate for homes with wood board siding (a combustible material).

The Insight: This strongly suggests that the siding material itself is not the deciding factor for inspectors. A home with fire-resistant masonry is just as likely to fail as a home with wood siding, almost certainly because of other, more critical vulnerabilities like the roof condition or the defensible space.

**Insight 2: Outliers with Small Sample Sizes**

A few materials show very high failure rates, but their sample sizes are too small to draw firm conclusions.

Metal siding has a 66.7% failure rate, and plastic has a 100% failure rate.

The Insight: It's crucial to note that these high rates are based on very few homes (only 6 with metal and 1 with plastic). While these materials performed poorly, we cannot generalize this to a wider population. They are interesting outliers but not a core trend.

**Insight 3: Why the Result is "Borderline Significant"**

This chart perfectly visualizes why the p-value was 0.0664 and not a stronger, more conclusive result.

No Clear Trend: There is no simple pattern. The pass rates (Yes) are remarkably similar across most of the common materials, generally falling between 23% and 33%. The failure rates (No) are inconsistent and don't follow a clear combustible vs. non-combustible pattern.

High Uncertainty: For many of the most common materials (hardboard, plywood, stucco), the largest single category is "Uncertain." This large amount of ambiguity in the outcomes makes it difficult to detect a strong, clear relationship between the variables.

**Final Conclusion for Siding**
The key conclusion is that siding material, on its own, is a poor and unreliable predictor of the final Cal Fire inspection outcome. The inspection is clearly a holistic assessment where other factors, such as roof condition, defensible space, and general maintenance, play a much more significant role in the final pass/fail decision.