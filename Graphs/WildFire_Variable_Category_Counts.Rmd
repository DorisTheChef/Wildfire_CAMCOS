---
title: "WildFire_Variable_Category"
output: html_document
date: "2025-09-08"
---

```{r fig.width=4, fig.height=4, fig.align="center", dpi=300}
# Wildfire Variable Category Bubble chart 
#360 columns in total with 2 UID, site and community repeating

# Install required packages (only if not already installed)
required_packages <- c("packcircles", "ggplot2", "ggforce", "viridis", "colorspace", "scales")
new_packages <- required_packages[!(required_packages %in% installed.packages()[,"Package"])]
if(length(new_packages)) install.packages(new_packages)

# Load libraries
library(packcircles)
library(ggplot2)
library(ggforce)
library(viridis)
library(colorspace)
library(scales)

# Data: Wildfire variable categories and their counts
df <- data.frame(
  Category = c("Information variables", "Roof", "Attic", "Windows", "Siding","Garage","Noncombustible", "Foundation", "Deck/Patio", "Fence", "Vents", "Fuels", "Man Made", "Outbuilding and Attached", "Count of Trees", "Access and Safety"),
  Count = c(38, 30, 5, 14, 17, 13, 3, 5, 33, 12, 7, 88, 24, 38, 13, 18)
)

# Create circle packing layout (area-proportional)
layout <- circleProgressiveLayout(df$Count, sizetype = "area")
df <- cbind(df, layout)  # adds x, y, radius columns

# Scale label sizes based on circle radius
df$label_size <- rescale(df$radius, to = c(2.6, 6.0))

# Create more differentiated color palette
n_colors <- length(unique(df$Category))
# Use a high-contrast palette with better color separation
vibrant_colors <- colorspace::qualitative_hcl(n_colors, palette = "Set 2", c = 80, l = 70)

# Adjust text size to fit better within circles (make it smaller relative to radius)
df$label_size <- rescale(df$radius, to = c(1.5, 3.0))

# Add line breaks for longer category names to fit better in circles
df$Category_wrapped <- gsub("Outbuilding and Attached", "Outbuilding\n& Attached", df$Category)
df$Category_wrapped <- gsub("Access and Safety", "Access &\nSafety", df$Category_wrapped)
df$Category_wrapped <- gsub("Information variables", "Information\nvariables", df$Category_wrapped)
df$Category_wrapped <- gsub("Count of Trees", "Count of\nTrees", df$Category_wrapped)

# Add count numbers to the labels
df$Label_with_count <- paste0(df$Category_wrapped, "\n(", df$Count, ")")

# Create the visualization
p <- ggplot(df) +
  # Draw circles WITHOUT borders
  ggforce::geom_circle(aes(x0 = x, y0 = y, r = radius, fill = Category),
                       color = NA, alpha = 0.9) +
  # Add category labels with count numbers
  geom_text(aes(x = x, y = y, label = Label_with_count, size = label_size),
            color = "black", lineheight = 0.85, fontface = "bold") +
  scale_size_identity() +
  scale_fill_manual(values = vibrant_colors, guide = "none") +
  coord_equal(expand = TRUE) +
  theme_void(base_size = 12) +
  theme(
    plot.background = element_rect(fill = "white", color = NA),
    plot.margin = margin(18, 18, 18, 18)
  ) +
  labs(title = "Wildfire Variable Categories",
       subtitle = "Circle size represents the count of variables \n in each category")

# Display the plot
print(p)

# Save the plot (optional)
ggsave("wildfire_variable_category_counts.png", p, width = 12, height = 10, dpi = 300, bg = "white")

cat("Visualization created successfully!\n")
cat("Plot saved as 'wildfire_variable_category_counts.png' in your working directory.\n")

```

