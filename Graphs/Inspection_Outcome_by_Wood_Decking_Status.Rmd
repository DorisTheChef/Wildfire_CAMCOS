---
title: "Inspection Outcome by Wood Decking Status"
author: "Priyanka Goel"
date: "2025-09-07"
output: html_document
---

```{r setup, include=FALSE}
# This chunk sets up the document and loads the reticulate package
# which allows R to run Python code.
knitr::opts_chunk$set(echo = TRUE)
library(reticulate)
```

```{python}
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
import textwrap
import matplotlib as mpl


mpl.rcParams['figure.constrained_layout.use'] = True

# --- 1. Load data ---
df = pd.read_excel('CAMCOS and HIZ.xlsx', sheet_name='Field data', header=1)

# --- 2. Define Columns and Create Crosstab ---
wood_decking_col = 'Deck/patio? (absent is that feature does not exist, satisfactory and maintenance is that the feature exists, NA is that feature not required e.g. concrete patio doesn\'t have deck boards. ) [Wood decking]'
inspection_col = 'Did it pass the most recent cal fire inspection?'

crosstab = pd.crosstab(df[wood_decking_col], df[inspection_col])
percentage_crosstab = crosstab.div(crosstab.sum(axis=1), axis=0) * 100

# --- 3. Plot setup ---
sns.set_style("whitegrid")
fig, ax = plt.subplots(figsize=(12, 6), constrained_layout=True)

percentage_crosstab.plot(
    kind='bar', 
    stacked=False,
    ax=ax,
    colormap='viridis',
    width=0.8
)

# --- 4. Add labels inside bars ---
for cont in ax.containers:
    ax.bar_label(cont, labels=[f'{v:.1f}%' for v in cont.datavalues], padding=3)

# --- 5. Titles and labels ---
title_txt = "Inspection Outcome Rates by Wood Decking Status"
plt.title(textwrap.fill(title_txt, 50), fontsize=18, weight='bold', pad=14)

plt.xlabel('Wood Decking Status', fontsize=12)
plt.ylabel('Percentage of Homes (%)', fontsize=12)
plt.xticks(rotation=0)

# --- 6. Legend (outside, wrapped title) ---
wrapped_leg_title = textwrap.fill(inspection_col, 25)
ax.legend(title=wrapped_leg_title, bbox_to_anchor=(1.02, 1), loc='upper left')

# Reserve room for title + legend
plt.subplots_adjust(right=0.80, top=0.90)

# --- 7. Headroom for labels ---
ax.set_ylim(0, max(percentage_crosstab.max()) * 1.25)

plt.show()

```
**Insight 1: A "Satisfactory" Wood Deck is a Negative Sign**

This is the most critical and surprising finding from the chart.

The failure rate (No) for homes where a wood deck was present and in "Satisfactory condition" is 29.2%. This is the highest failure rate of the three categories. In contrast, the failure rate for homes where the wood deck "Needs maintenance" is only 12.1%.

The Insight: It tells us that a well-maintained wood deck does not guarantee a home will pass the inspection; in fact, it's associated with a higher failure rate. This strongly suggests that homes are failing for other, more severe reasons that are completely unrelated to the deck's condition. 

**Insight 2: The "Pass" Rate is Relatively Stable**

The pass rate (Yes) is fairly consistent across all three categories, hovering between 18.8% and 31.7%. There isn't a dramatic difference.

The Insight: This reinforces the idea that the presence or condition of a wood deck is not a primary driver of passing the inspection either.

**Insight 3: Why the P-value was "Borderline"**

This chart visually explains the borderline p-value.

The Chi-Squared test picked up on the subtle differences in the distribution of outcomes between the three categories. The fact that the "Satisfactory" group had the highest failure rate, while the "Needs maintenance" group had the lowest, is a non-random pattern, even if it's not a dramatic one.

However, because the "Uncertain" category is so large in all three groups, it dilutes the overall effect, preventing the p-value from being strongly significant (i.e., less than 0.05).

**Final Conclusion**
The presence or condition of a wood deck is not a reliable standalone predictor of the Cal Fire inspection outcome. The relationship is complex and heavily influenced by other factors. A home with a perfect wood deck can still fail, and a home with a wood deck needing maintenance can still pass, depending on the overall condition of the property.
