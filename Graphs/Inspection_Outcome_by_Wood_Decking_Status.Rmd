---
title: "Inspection Outcome by Wood Decking Status"
author: "Priyanka Goel"
date: "2025-09-07"
output: html_document
---


```{r}
library(readxl)
library(dplyr)
library(ggplot2)
library(viridis)
library(stringr)

setwd("/Users/priyankagoel")
# Load data
df <- read_excel("CAMCOS and HIZ.xlsx", sheet = "Field data", skip = 1)

# Define column names
wood_decking_col <- "Deck/patio? (absent is that feature does not exist, satisfactory and maintenance is that the feature exists, NA is that feature not required e.g. concrete patio doesn't have deck boards. ) [Wood decking]"
inspection_col <- "Did it pass the most recent cal fire inspection?"

# Crosstab with percentages
crosstab <- table(df[[wood_decking_col]], df[[inspection_col]])
percentage_crosstab <- prop.table(crosstab, margin = 1) * 100
plot_data <- as.data.frame(percentage_crosstab)
colnames(plot_data) <- c("WoodDecking", "Inspection", "Percentage")

# Improve label order manually (optional, based on your image)
plot_data$WoodDecking <- factor(plot_data$WoodDecking,
  levels = c("Absent", "Needs maintenance", "Satisfactory condition")
)

# Plot
ggplot(plot_data, aes(x = WoodDecking, y = Percentage, fill = Inspection)) +
  geom_col(position = position_dodge(width = 0.8), width = 0.75) +
  geom_text(
    aes(label = sprintf("%.1f%%", Percentage)),
    position = position_dodge(width = 0.8),
    vjust = -0.5,
    size = 3.5
  ) +
  scale_fill_viridis_d() +
  labs(
    title = str_wrap("Inspection Outcome Rates by Wood Decking Status", 40),
    x = "Wood Decking Status",
    y = "Percentage of Homes (%)",
    fill = str_wrap(inspection_col, 25)
  ) +
  theme_minimal(base_size = 14) +
  theme(
    plot.title = element_text(face = "bold", hjust = 0.5, margin = margin(b = 10)),
    axis.text.x = element_text(angle = 15, hjust = 1),
    legend.position = "right",
    legend.justification = "top",
    legend.title = element_text(size = 10),
    legend.text = element_text(size = 9),
    plot.margin = margin(t = 30, r = 90, b = 20, l = 20)  # top-right-bottom-left
  ) +
  ylim(0, max(plot_data$Percentage) * 1.25)

```


**Insight 1: A "Satisfactory" Wood Deck is a Negative Sign**

This is the most critical and surprising finding from the chart.

The failure rate (No) for homes where a wood deck was present and in "Satisfactory condition" is 29.2%. This is the highest failure rate of the three categories. In contrast, the failure rate for homes where the wood deck "Needs maintenance" is only 12.1%.

The Insight: It tells us that a well-maintained wood deck does not guarantee a home will pass the inspection; in fact, it's associated with a higher failure rate. This strongly suggests that homes are failing for other, more severe reasons that are completely unrelated to the deck's condition. 

**Insight 2: The "Pass" Rate is Relatively Stable**

The pass rate (Yes) is fairly consistent across all three categories, hovering between 18.8% and 31.7%. There isn't a dramatic difference.

The Insight: This reinforces the idea that the presence or condition of a wood deck is not a primary driver of passing the inspection either.

**Insight 3: Why the P-value was "Borderline"**

This chart visually explains the borderline p-value.

The Chi-Squared test picked up on the subtle differences in the distribution of outcomes between the three categories. The fact that the "Satisfactory" group had the highest failure rate, while the "Needs maintenance" group had the lowest, is a non-random pattern, even if it's not a dramatic one.

However, because the "Uncertain" category is so large in all three groups, it dilutes the overall effect, preventing the p-value from being strongly significant (i.e., less than 0.05).

**Final Conclusion**
The presence or condition of a wood deck is not a reliable standalone predictor of the Cal Fire inspection outcome. The relationship is complex and heavily influenced by other factors. A home with a perfect wood deck can still fail, and a home with a wood deck needing maintenance can still pass, depending on the overall condition of the property.
